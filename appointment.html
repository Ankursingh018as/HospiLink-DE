<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment</title>
    <link rel="stylesheet" href="css/typography.css">
    <link rel="stylesheet" href="css/style.css?v=2">
    <link rel="stylesheet" href="css/appointment_new.css?v=4">
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
    rel="stylesheet"/>
    <link rel="icon" href="images/hosp_favicon.png" type="image/png">
</head>
<body>
   <div class="main">
      <div class="nav">
        <a href="index.html"> <img src="images/logo.png" alt=""> </a>
         <div class="nav-part2">
            <h4><a href="index.html"><abbr title="Home">Home</abbr></a></h4>
            <h4><a href="appointment.html"><abbr title="Book Appointment">Book Appointment</abbr></a></h4>
            <h4><a href="beds.html"><abbr title="Beds Availability">Beds</abbr></a></h4>
            <h4><a href="admit.html"><abbr title="Admit Patient">Admit Patient</abbr></a></h4>
            <h4><a href="contact.html"><abbr title="Contact Us">Contact Us</abbr></a></h4>
            <button><a href="sign_new.html"><abbr title="Sign In">Sign In</abbr></a></button>
            <i class="ri-menu-3-line"></i>
         </div>
      </div>
</div>
    <div class="content">
        <div class="appointment-wrapper">
            <div class="container">
                <h1>Book Your <span>Appointment</span></h1>
                <p class="subtitle">Complete the form in 3 easy steps</p>

                <!-- Progress Indicator -->
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-steps">
                        <div class="progress-step active" data-step="1">
                            <div class="step-circle">
                                <i class="ri-user-line"></i>
                                <span class="step-number">1</span>
                            </div>
                            <span class="step-label">Personal Details</span>
                        </div>
                        <div class="progress-step" data-step="2">
                            <div class="step-circle">
                                <i class="ri-hospital-line"></i>
                                <span class="step-number">2</span>
                            </div>
                            <span class="step-label">Appointment Info</span>
                        </div>
                        <div class="progress-step" data-step="3">
                            <div class="step-circle">
                                <i class="ri-check-line"></i>
                                <span class="step-number">3</span>
                            </div>
                            <span class="step-label">Review & Submit</span>
                        </div>
                    </div>
                </div>

                <form action="php/appointment.php" method="POST" id="appointmentForm">
                    <!-- Step 1: Personal Details -->
                    <div class="form-step active" id="step1">
                        <div class="step-header">
                            <h2><i class="ri-user-line"></i> Personal Details</h2>
                            <p>Let us know who you are</p>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="name">
                                    <i class="ri-user-fill"></i> Full Name *
                                </label>
                                <input type="text" id="name" name="name" placeholder="Enter your full name" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="email">
                                    <i class="ri-mail-fill"></i> Email Address *
                                </label>
                                <input type="email" id="email" name="email" placeholder="your.email@example.com" required>
                                <div class="email-verification-badge" style="display: none; margin-top: 8px; padding: 8px 12px; background: #e8f5e9; border-left: 3px solid #4caf50; border-radius: 4px; font-size: 0.85rem; color: #2e7d32;">
                                    <i class="ri-shield-check-fill"></i> Email will be verified after submission
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="phone">
                                    <i class="ri-phone-fill"></i> Phone Number *
                                </label>
                                <input type="tel" id="phone" name="phone" placeholder="+91 98765 43210" required>
                            </div>
                        </div>

                        <!-- User Pre-fill Notification -->
                        <div id="prefillNotification" style="display: none; margin-top: 15px; padding: 12px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white; font-size: 0.9rem;">
                            <i class="ri-user-smile-fill"></i> <strong>Welcome back!</strong> We've pre-filled your information. <button type="button" onclick="unlockFields()" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 12px; border-radius: 4px; margin-left: 10px; cursor: pointer; font-size: 0.85rem;">Edit Info</button>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="gender">
                                    <i class="ri-user-heart-fill"></i> Gender *
                                </label>
                                <select id="gender" name="gender" required>
                                    <option value="" disabled selected>Select Your Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Others">Others</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-next" onclick="nextStep(1)">
                                Continue <i class="ri-arrow-right-line"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Appointment Information -->
                    <div class="form-step" id="step2">
                        <div class="step-header">
                            <h2><i class="ri-hospital-line"></i> Appointment Information</h2>
                            <p>Tell us about your health concern</p>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="symptoms">
                                    <i class="ri-stethoscope-fill"></i> Describe Your Symptoms *
                                </label>
                                
                                <!-- Quick Symptom Chips -->
                                <div class="symptom-chips" style="margin-bottom: 12px; display: flex; flex-wrap: wrap; gap: 8px;">
                                    <button type="button" class="symptom-chip" onclick="addSymptom('Fever and high temperature')">ðŸ¤’ Fever</button>
                                    <button type="button" class="symptom-chip" onclick="addSymptom('Chest pain and discomfort')">ðŸ’” Chest Pain</button>
                                    <button type="button" class="symptom-chip" onclick="addSymptom('Persistent cough')">ðŸ˜· Cough</button>
                                    <button type="button" class="symptom-chip" onclick="addSymptom('Severe headache')">ðŸ¤• Headache</button>
                                    <button type="button" class="symptom-chip" onclick="addSymptom('Physical injury or trauma')">ðŸ©¹ Injury</button>
                                    <button type="button" class="symptom-chip" onclick="addSymptom('Follow-up consultation')">ðŸ“‹ Follow-up</button>
                                </div>
                                
                                <textarea id="symptoms" name="symptoms" placeholder="Please describe your symptoms in detail (e.g., chest pain, high fever, cough, etc.). This helps our AI system prioritize your appointment based on urgency." rows="5" required></textarea>
                                
                                <!-- AI Urgency Feedback -->
                                <div id="aiUrgencyFeedback" style="display: none; margin-top: 12px; padding: 16px; border-radius: 10px; background: linear-gradient(135deg, #f0fafb 0%, #e6f7f8 100%); border-left: 4px solid #00adb5; box-shadow: 0 2px 8px rgba(0, 173, 181, 0.1);">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                        <i class="ri-brain-fill" style="font-size: 1.3rem; color: #00adb5;"></i>
                                        <strong style="color: #333;">AI Evaluation:</strong>
                                        <span id="aiUrgencyLevel" style="padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: 600;"></span>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #555; margin-left: 33px;">
                                        <i class="ri-time-fill"></i> <span id="aiConsultationTime"></span>
                                    </div>
                                    <div id="aiWarning" style="display: none; margin-top: 10px; padding: 10px; background: #fff3cd; border-left: 3px solid #ff9800; border-radius: 4px; font-size: 0.85rem; color: #856404;">
                                        <i class="ri-alert-fill"></i> <strong>Important:</strong> <span id="aiWarningText"></span>
                                    </div>
                                </div>
                                
                                <small class="form-hint">
                                    <i class="ri-information-fill"></i> Our AI analyzes symptoms to prioritize urgent cases
                                </small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="date">
                                    <i class="ri-calendar-fill"></i> Preferred Date *
                                </label>
                                <input type="date" id="date" name="date" required>
                            </div>
                            <div class="form-group">
                                <label for="time">
                                    <i class="ri-time-fill"></i> Preferred Time *
                                </label>
                                <input type="time" id="time" name="time" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="s_doctor">
                                    <i class="ri-user-star-fill"></i> Recommended Doctor (AI-assisted)
                                </label>
                                <select id="s_doctor" name="s_doctor">
                                    <option value="">Any Available Doctor</option>
                                    <option value="Dr. Ramesh Patel">Dr. Ramesh Patel - Cardiology</option>
                                    <option value="Dr. Harsh Shah">Dr. Harsh Shah - General Medicine</option>
                                    <option value="Dr. Mehul Poonawala">Dr. Mehul Poonawala - Pediatrics</option>
                                </select>
                                <div id="aiDoctorRecommendation" style="display: none; margin-top: 10px; padding: 10px 12px; background: #e3f2fd; border-left: 3px solid #2196f3; border-radius: 4px; font-size: 0.85rem; color: #1565c0;">
                                    <i class="ri-lightbulb-flash-fill"></i> <strong>AI Suggestion:</strong> <span id="aiDoctorText"></span>
                                </div>
                                <small class="form-hint">
                                    <i class="ri-information-fill"></i> AI recommends a specialist, but you can choose any doctor
                                </small>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-back" onclick="prevStep(2)">
                                <i class="ri-arrow-left-line"></i> Back
                            </button>
                            <button type="button" class="btn-next" onclick="nextStep(2)">
                                Review <i class="ri-arrow-right-line"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Review & Submit -->
                    <div class="form-step" id="step3">
                        <div class="step-header">
                            <h2><i class="ri-check-line"></i> Review Your Appointment</h2>
                            <p>Please verify all details before submitting</p>
                        </div>

                        <div class="review-section">
                            <!-- AI Priority Summary -->
                            <div id="aiPrioritySummary" class="review-card" style="display: none; background: linear-gradient(135deg, #00adb5 0%, #0e545f 100%); color: white; border: none; box-shadow: 0 4px 15px rgba(0, 173, 181, 0.3);">
                                <h3 style="color: white;"><i class="ri-ai-generate"></i> AI Priority Assessment</h3>
                                <div class="review-item" style="border-color: rgba(255,255,255,0.2);">
                                    <span class="review-label" style="color: rgba(255,255,255,0.9);">Priority Level:</span>
                                    <span class="review-value" id="review-priority" style="color: white; font-weight: 600;"></span>
                                </div>
                                <div class="review-item" style="border-color: rgba(255,255,255,0.2);">
                                    <span class="review-label" style="color: rgba(255,255,255,0.9);">Assessment:</span>
                                    <span class="review-value" id="review-assessment" style="color: white;"></span>
                                </div>
                                <div style="margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 6px; font-size: 0.85rem; line-height: 1.5;">
                                    <i class="ri-information-fill"></i> Priority calculated based on AI analysis of symptoms and medical history
                                </div>
                            </div>
                            
                            <div class="review-card">
                                <h3><i class="ri-user-line"></i> Personal Information</h3>
                                <div class="review-item">
                                    <span class="review-label">Name:</span>
                                    <span class="review-value" id="review-name"></span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Email:</span>
                                    <span class="review-value" id="review-email"></span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Phone:</span>
                                    <span class="review-value" id="review-phone"></span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Gender:</span>
                                    <span class="review-value" id="review-gender"></span>
                                </div>
                            </div>

                            <div class="review-card">
                                <h3><i class="ri-hospital-line"></i> Appointment Details</h3>
                                <div class="review-item">
                                    <span class="review-label">Date:</span>
                                    <span class="review-value" id="review-date"></span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Time:</span>
                                    <span class="review-value" id="review-time"></span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Doctor:</span>
                                    <span class="review-value" id="review-doctor"></span>
                                </div>
                                <div class="review-item full-width">
                                    <span class="review-label">Symptoms:</span>
                                    <span class="review-value" id="review-symptoms"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-back" onclick="prevStep(3)">
                                <i class="ri-arrow-left-line"></i> Back
                            </button>
                            <button type="submit" class="btn-submit">
                                <i class="ri-send-plane-fill"></i> Book Appointment
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Set minimum date to today
        document.getElementById('date').min = new Date().toISOString().split('T')[0];

        let currentStep = 1;
        let aiAnalysisData = null;
        let fieldsLocked = false;

        // Check for authenticated user and pre-fill
        window.addEventListener('DOMContentLoaded', function() {
            checkAuthAndPrefill();
            showEmailVerificationBadge();
            setupSymptomAnalysis();
        });

        function showEmailVerificationBadge() {
            const badge = document.querySelector('.email-verification-badge');
            if (badge) badge.style.display = 'flex';
        }

        function checkAuthAndPrefill() {
            // Check if user is logged in (check session via API)
            fetch('php/get_profile.php')
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.user_id) {
                        // User is logged in, pre-fill form
                        const fullName = (data.first_name || '') + ' ' + (data.last_name || '');
                        document.getElementById('name').value = fullName.trim();
                        document.getElementById('email').value = data.email || '';
                        document.getElementById('phone').value = data.phone || '';
                        if (data.gender) {
                            document.getElementById('gender').value = data.gender;
                        }
                        
                        // Lock fields and show notification
                        lockFields();
                        document.getElementById('prefillNotification').style.display = 'flex';
                        document.getElementById('prefillNotification').style.alignItems = 'center';
                    }
                })
                .catch(err => {
                    // User not logged in or error - continue as guest
                    console.log('Guest booking mode');
                });
        }

        function lockFields() {
            fieldsLocked = true;
            document.getElementById('name').readOnly = true;
            document.getElementById('email').readOnly = true;
            document.getElementById('phone').readOnly = true;
            document.getElementById('gender').disabled = true;
            
            // Add visual indication
            document.getElementById('name').style.backgroundColor = '#f5f5f5';
            document.getElementById('email').style.backgroundColor = '#f5f5f5';
            document.getElementById('phone').style.backgroundColor = '#f5f5f5';
            document.getElementById('gender').style.backgroundColor = '#f5f5f5';
        }

        function unlockFields() {
            fieldsLocked = false;
            document.getElementById('name').readOnly = false;
            document.getElementById('email').readOnly = false;
            document.getElementById('phone').readOnly = false;
            document.getElementById('gender').disabled = false;
            
            document.getElementById('name').style.backgroundColor = '';
            document.getElementById('email').style.backgroundColor = '';
            document.getElementById('phone').style.backgroundColor = '';
            document.getElementById('gender').style.backgroundColor = '';
            
            document.getElementById('prefillNotification').style.display = 'none';
            document.getElementById('name').focus();
        }

        function addSymptom(symptomText) {
            const symptomsField = document.getElementById('symptoms');
            const currentValue = symptomsField.value.trim();
            
            if (currentValue) {
                symptomsField.value = currentValue + ', ' + symptomText;
            } else {
                symptomsField.value = symptomText;
            }
            
            symptomsField.focus();
            // Trigger AI analysis
            analyzeSymptoms();
        }

        function setupSymptomAnalysis() {
            const symptomsField = document.getElementById('symptoms');
            let analysisTimeout;
            
            symptomsField.addEventListener('input', function() {
                clearTimeout(analysisTimeout);
                analysisTimeout = setTimeout(() => {
                    if (symptomsField.value.trim().length > 10) {
                        analyzeSymptoms();
                    }
                }, 1000); // Wait 1 second after user stops typing
            });
        }

        function analyzeSymptoms() {
            const symptoms = document.getElementById('symptoms').value.trim();
            
            if (symptoms.length < 10) return;
            
            // Show loading state
            const feedbackDiv = document.getElementById('aiUrgencyFeedback');
            feedbackDiv.style.display = 'block';
            feedbackDiv.innerHTML = '<div style="text-align: center; padding: 10px;"><i class="ri-loader-4-line" style="animation: spin 1s linear infinite; font-size: 1.5rem; color: #00adb5;"></i> Analyzing symptoms...</div>';
            
            // Call AI preview endpoint
            fetch('php/get_ai_preview.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'symptoms=' + encodeURIComponent(symptoms)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    aiAnalysisData = data;
                    displayAIFeedback(data);
                } else {
                    feedbackDiv.style.display = 'none';
                }
            })
            .catch(err => {
                console.error('AI analysis error:', err);
                feedbackDiv.style.display = 'none';
            });
        }

        function displayAIFeedback(data) {
            const feedbackDiv = document.getElementById('aiUrgencyFeedback');
            const urgencyLevel = document.getElementById('aiUrgencyLevel');
            const consultationTime = document.getElementById('aiConsultationTime');
            const warningDiv = document.getElementById('aiWarning');
            const warningText = document.getElementById('aiWarningText');
            const doctorRecommendation = document.getElementById('aiDoctorRecommendation');
            const doctorText = document.getElementById('aiDoctorText');
            
            // Show feedback
            feedbackDiv.style.display = 'block';
            feedbackDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <i class="ri-brain-fill" style="font-size: 1.3rem; color: #00adb5;"></i>
                    <strong style="color: #0e545f; font-size: 1.05rem;">AI Evaluation:</strong>
                    <span id="aiUrgencyLevel" style="padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; letter-spacing: 0.3px;"></span>
                </div>
                <div style="font-size: 0.95rem; color: #555; margin-left: 38px; line-height: 1.6;">
                    <i class="ri-time-fill" style="color: #00adb5;"></i> <span id="aiConsultationTime"></span>
                </div>
                <div id="aiWarning" style="display: none; margin-top: 12px; padding: 12px; background: #fff3cd; border-left: 3px solid #ff9800; border-radius: 6px; font-size: 0.9rem; color: #856404;">
                    <i class="ri-alert-fill"></i> <strong>Important:</strong> <span id="aiWarningText"></span>
                </div>
            `;
            
            const newUrgencyLevel = document.getElementById('aiUrgencyLevel');
            const newConsultationTime = document.getElementById('aiConsultationTime');
            const newWarningDiv = document.getElementById('aiWarning');
            const newWarningText = document.getElementById('aiWarningText');
            
            // Set priority level with color
            const priorityColors = {
                'critical': { bg: '#d32f2f', text: 'white' },
                'high': { bg: '#f57c00', text: 'white' },
                'medium': { bg: '#00adb5', text: 'white' },
                'low': { bg: '#4caf50', text: 'white' }
            };
            
            const priority = data.priority_level.toLowerCase();
            const colors = priorityColors[priority] || priorityColors['medium'];
            
            newUrgencyLevel.textContent = data.priority_level.charAt(0).toUpperCase() + data.priority_level.slice(1) + ' Priority';
            newUrgencyLevel.style.backgroundColor = colors.bg;
            newUrgencyLevel.style.color = colors.text;
            
            // Set consultation time
            const timeframes = {
                'immediate': 'Seek immediate medical attention',
                'urgent': 'Consultation recommended within 24 hours',
                'routine': 'Consultation recommended within 2-3 days',
                'low': 'Routine consultation at your convenience'
            };
            newConsultationTime.textContent = timeframes[data.time_sensitivity] || 'Consultation recommended soon';
            
            // Show warning for critical/high priority
            if (priority === 'critical' || priority === 'high') {
                newWarningDiv.style.display = 'block';
                if (priority === 'critical') {
                    newWarningText.textContent = 'This appears to be a serious condition. If symptoms worsen, please visit the emergency room immediately.';
                    newWarningDiv.style.background = '#ffebee';
                    newWarningDiv.style.borderLeftColor = '#d32f2f';
                    newWarningDiv.style.color = '#c62828';
                } else {
                    newWarningText.textContent = 'Please book your appointment as soon as possible for timely medical attention.';
                }
            }
            
            // Show doctor recommendation
            if (data.recommended_doctor) {
                const doctorRecommendation = document.getElementById('aiDoctorRecommendation');
                const doctorText = document.getElementById('aiDoctorText');
                
                doctorRecommendation.style.display = 'block';
                doctorText.textContent = 'Based on your symptoms, we recommend: ' + data.recommended_doctor;
                
                // Auto-select recommended doctor if available
                const doctorSelect = document.getElementById('s_doctor');
                const doctorOptions = Array.from(doctorSelect.options);
                
                // Try exact match first
                let matchingOption = doctorOptions.find(opt => opt.value === data.recommended_doctor);
                
                // If no exact match, try partial match
                if (!matchingOption && data.specialization) {
                    matchingOption = doctorOptions.find(opt => 
                        opt.text.toLowerCase().includes(data.specialization.toLowerCase())
                    );
                }
                
                if (matchingOption) {
                    doctorSelect.value = matchingOption.value;
                    // Highlight the selected option
                    doctorSelect.style.borderColor = '#00adb5';
                    doctorSelect.style.borderWidth = '2px';
                }
            }
        }

        function updateProgress() {
            const steps = document.querySelectorAll('.progress-step');
            const progressFill = document.getElementById('progressFill');
            const percentage = ((currentStep - 1) / 2) * 100;
            
            progressFill.style.width = percentage + '%';
            
            steps.forEach((step, index) => {
                const stepNum = index + 1;
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        function validateStep(step) {
            const currentStepElement = document.getElementById('step' + step);
            const inputs = currentStepElement.querySelectorAll('input[required], select[required], textarea[required]');
            
            for (let input of inputs) {
                if (!input.value.trim()) {
                    input.focus();
                    input.classList.add('error-shake');
                    setTimeout(() => input.classList.remove('error-shake'), 500);
                    return false;
                }
            }
            return true;
        }

        function nextStep(step) {
            if (!validateStep(step)) {
                return;
            }

            document.getElementById('step' + step).classList.remove('active');
            currentStep++;
            document.getElementById('step' + currentStep).classList.add('active');
            
            if (currentStep === 3) {
                updateReview();
            }
            
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function prevStep(step) {
            document.getElementById('step' + step).classList.remove('active');
            currentStep--;
            document.getElementById('step' + currentStep).classList.add('active');
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateReview() {
            document.getElementById('review-name').textContent = document.getElementById('name').value;
            document.getElementById('review-email').textContent = document.getElementById('email').value;
            document.getElementById('review-phone').textContent = document.getElementById('phone').value;
            document.getElementById('review-gender').textContent = document.getElementById('gender').value;
            
            const dateValue = document.getElementById('date').value;
            const formattedDate = new Date(dateValue + 'T00:00:00').toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('review-date').textContent = formattedDate;
            
            const timeValue = document.getElementById('time').value;
            const [hours, minutes] = timeValue.split(':');
            const time12 = new Date(2000, 0, 1, hours, minutes).toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
            document.getElementById('review-time').textContent = time12;
            
            const doctor = document.getElementById('s_doctor').value || 'Any Available Doctor';
            document.getElementById('review-doctor').textContent = doctor;
            
            document.getElementById('review-symptoms').textContent = document.getElementById('symptoms').value;
            
            // Show AI Priority Summary if available
            if (aiAnalysisData) {
                const prioritySummary = document.getElementById('aiPrioritySummary');
                prioritySummary.style.display = 'block';
                
                const priorityLevel = aiAnalysisData.priority_level.charAt(0).toUpperCase() + aiAnalysisData.priority_level.slice(1);
                document.getElementById('review-priority').textContent = priorityLevel + ' Priority';
                
                const assessment = aiAnalysisData.urgency_reason || 'Based on your symptoms, our AI has assessed the urgency level of your condition.';
                document.getElementById('review-assessment').textContent = assessment;
            }
        }

        // Initialize progress
        updateProgress();
        
        // Add CSS for spinning animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            .symptom-chip {
                padding: 8px 16px;
                border: 1px solid #00adb5;
                background: white;
                color: #00adb5;
                border-radius: 20px;
                font-size: 0.85rem;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .symptom-chip:hover {
                background: #00adb5;
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 173, 181, 0.3);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>