<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Beds Availability</title>
    <link rel="stylesheet" href="css/typography.css">
    <link rel="stylesheet" href="css/style.css?v=2">
    <link rel="stylesheet" href="css/beds_new.css?v=3">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
    <link rel="icon" href="images/hosp_favicon.png" type="image/png">
</head>
<body>
   <div class="main">
      <div class="nav">
          <a href="index.html"> <img src="images/logo.png" alt=""> </a>
         <div class="nav-part2">
            <h4><a href="index.html"><abbr title="Home">Home</abbr></a></h4>
            <h4><a href="appointment.html"><abbr title="Book Appointment">Book Appointment</abbr></a></h4>
            <h4><a href="beds.html"><abbr title="Beds Availability">Beds</abbr></a></h4>
            <h4><a href="admit.html"><abbr title="Admit Patient"> Admit Patient</abbr></a></h4>
            <h4><a href="contact.html"><abbr title="Contact Us">Contact Us</abbr></a></h4>
            <button><a href="sign_new.html"><abbr title="Sign In">Sign In</abbr></a></button>
            <i class="ri-menu-3-line"></i>
         </div>
      </div>
   </div>
       <!-- Page Header -->
       <section class="page-header-beds">
           <div class="header-content">
               <h1><i class="ri-hotel-bed-line"></i> Real-time Beds Availability</h1>
               <p>Monitor live bed availability across all wards</p>
               <div class="last-updated">
                   <i class="ri-time-line"></i> Last updated: <span id="lastUpdated">Loading...</span>
                   <span id="autoRefresh" style="margin-left: 15px; color: #28a745;">
                       <i class="ri-refresh-line"></i> Auto-refresh: ON
                   </span>
               </div>
           </div>
       </section>

       <!-- Beds -->
       <section id="beds" class="beds">
        <div class="beds-container">
           <div class="stat-card available-card">
                <div class="stat-icon-wrapper">
                    <i class="ri-check-double-line stat-icon"></i>
                </div>
                <div class="stat-content">
                    <h2>Available Beds</h2>
                    <h3 class="stat-number" id="availableBeds">--</h3>
                    <span class="stat-label">Ready for patients</span>
                </div>
           </div>

           <div class="stat-card total-card">
                <div class="stat-icon-wrapper">
                    <i class="ri-hotel-bed-line stat-icon"></i>
                </div>
                <div class="stat-content">
                    <h2>Total Beds</h2>
                    <h3 class="stat-number" id="totalBeds">--</h3>
                    <span class="stat-label">Across all wards</span>
                </div>
           </div>

           <div class="stat-card occupied-card">
                <div class="stat-icon-wrapper">
                    <i class="ri-user-fill stat-icon"></i>
                </div>
                <div class="stat-content">
                    <h2>Occupied Beds</h2>
                    <h3 class="stat-number" id="occupiedBeds">--</h3>
                    <span class="stat-label">Currently in use</span>
                </div>
           </div>

           <div class="stat-card ward-card">
                <div class="stat-icon-wrapper">
                    <i class="ri-hospital-line stat-icon"></i>
                </div>
                <div class="stat-content">
                    <h2>Maintenance</h2>
                    <h3 class="stat-number" id="maintenanceBeds">--</h3>
                    <span class="stat-label">Under repair</span>
                </div>
           </div>
       </div>

       <div class="ward-section">
            <div class="section-header">
                <h2><i class="ri-building-line"></i> Ward-wise Real-time Breakdown</h2>
                <p>Detailed availability across specialized units</p>
            </div>
            <div class="ward-grid" id="wardGrid">
                <!-- Dynamic ward cards will be loaded here -->
                <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                    <i class="ri-loader-4-line" style="font-size: 48px; color: #00adb5; animation: spin 1s linear infinite;"></i>
                    <p style="margin-top: 15px; color: #666;">Loading real-time bed data...</p>
                </div>
            </div>
       </div>

       <div class="action-section">
            <div class="section-header">
                <h2><i class="ri-flashlight-line"></i> Quick Actions</h2>
                <p>Get started with essential services</p>
            </div>
            <div class="action-buttons">
                <a href="appointment.html" class="action-btn action-primary">
                    <div class="btn-icon">
                        <i class="ri-calendar-check-line"></i>
                    </div>
                    <div class="btn-content">
                        <span class="btn-title">Book Appointment</span>
                        <span class="btn-desc">Schedule your visit</span>
                    </div>
                </a>
                <a href="admit.html" class="action-btn action-secondary">
                    <div class="btn-icon">
                        <i class="ri-hospital-line"></i>
                    </div>
                    <div class="btn-content">
                        <span class="btn-title">Admit Patient</span>
                        <span class="btn-desc">Start admission process</span>
                    </div>
                </a>
                <a href="contact.html" class="action-btn action-tertiary">
                    <div class="btn-icon">
                        <i class="ri-customer-service-line"></i>
                    </div>
                    <div class="btn-content">
                        <span class="btn-title">Contact Support</span>
                        <span class="btn-desc">We're here to help</span>
                    </div>
                </a>
            </div>
       </div>
    </section>

    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .ward-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .ward-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .ward-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .ward-icon {
            background: #00adb5;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .ward-header h3 {
            font-size: 20px;
            color: #333;
        }
        .ward-stats {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .ward-stat {
            flex: 1;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .ward-stat.available { background: #d4edda; color: #155724; }
        .ward-stat.occupied { background: #f8d7da; color: #721c24; }
        .ward-stat .number {
            font-size: 28px;
            font-weight: bold;
            display: block;
        }
        .ward-stat .label {
            font-size: 12px;
            text-transform: uppercase;
            margin-top: 5px;
            display: block;
        }
    </style>

    <script>
        // Real-time bed data management
        let refreshInterval;
        
        // Update last updated time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true 
            });
            document.getElementById('lastUpdated').textContent = timeString;
        }
        
        // Fetch real-time bed data
        async function fetchBedData() {
            try {
                const response = await fetch('php/get_available_beds.php');
                const data = await response.json();
                
                if (data.success) {
                    updateBedStats(data.stats);
                    updateWardBreakdown(data.wards);
                    updateTime();
                }
            } catch (error) {
                console.error('Error fetching bed data:', error);
                document.getElementById('lastUpdated').textContent = 'Error loading data';
            }
        }
        
        // Update bed statistics
        function updateBedStats(stats) {
            document.getElementById('availableBeds').textContent = stats.available || 0;
            document.getElementById('totalBeds').textContent = stats.total || 0;
            document.getElementById('occupiedBeds').textContent = stats.occupied || 0;
            document.getElementById('maintenanceBeds').textContent = stats.maintenance || 0;
        }
        
        // Update ward breakdown
        function updateWardBreakdown(wards) {
            const wardGrid = document.getElementById('wardGrid');
            
            if (!wards || wards.length === 0) {
                wardGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <i class="ri-information-line" style="font-size: 48px; color: #666;"></i>
                        <p style="margin-top: 15px; color: #666;">No ward data available</p>
                    </div>
                `;
                return;
            }
            
            wardGrid.innerHTML = wards.map(ward => `
                <div class="ward-card ward-${ward.name.toLowerCase().replace(/\s+/g, '-')}">
                    <div class="ward-header">
                        <div class="ward-icon">
                            <i class="ri-hospital-line"></i>
                        </div>
                        <h3>${ward.name}</h3>
                    </div>
                    <div class="ward-stats">
                        <div class="ward-stat available">
                            <span class="number">${ward.available || 0}</span>
                            <span class="label">Available</span>
                        </div>
                        <div class="ward-stat occupied">
                            <span class="number">${ward.occupied || 0}</span>
                            <span class="label">Occupied</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; text-align: center; color: #666; font-size: 14px;">
                        Total Beds: <strong>${ward.total || 0}</strong>
                    </div>
                </div>
            `).join('');
        }
        
        // Initialize and start auto-refresh
        function init() {
            fetchBedData(); // Initial load
            refreshInterval = setInterval(fetchBedData, 10000); // Refresh every 10 seconds
        }
        
        // Start on page load
        window.addEventListener('DOMContentLoaded', init);
        
        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) clearInterval(refreshInterval);
        });
    </script>
</body>
</html>
