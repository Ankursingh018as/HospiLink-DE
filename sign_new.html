<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register & Login - HospiLink</title>
    <link rel="stylesheet" href="css/typography.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/sign.css">
    <link rel="icon" href="images/hosp_favicon.png" type="image/png">
</head>
<body>
    <!-- Registration Form -->
    <div class="container" id="signup" style="display:none;">
      <h1 class="form-title">Register</h1>
      <form method="post" action="php/auth.php">
        <div class="input-group">
           <i class="fas fa-user"></i>
           <input type="text" name="fName" id="fName" placeholder="First Name" required>
           <label for="fName">First Name</label>
        </div>
        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" name="lName" id="lName" placeholder="Last Name" required>
            <label for="lName">Last Name</label>
        </div>
        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" name="email" id="regEmail" placeholder="Email" required>
            <label for="regEmail">Email</label>
        </div>
        <div class="input-group">
            <i class="fas fa-phone"></i>
            <input type="tel" name="phone" id="phone" placeholder="Phone Number" pattern="[0-9]{10}" required>
            <label for="phone">Phone Number</label>
        </div>
        <div class="input-group">
            <i class="fas fa-user-tag"></i>
            <select name="role" id="role" required>
                <option value="">Select Role</option>
                <option value="patient">Patient</option>
                <option value="doctor">Doctor</option>
                <option value="staff">Hospital Staff</option>
                <option value="admin">Admin</option>
            </select>
            <label for="role">Role</label>
        </div>
        <!-- Conditional fields for doctors -->
        <div id="doctorFields" style="display:none;">
            <div class="input-group">
                <i class="fas fa-stethoscope"></i>
                <input type="text" name="specialization" id="specialization" placeholder="Specialization">
                <label for="specialization">Specialization</label>
            </div>
            <div class="input-group">
                <i class="fas fa-hospital"></i>
                <input type="text" name="department" id="doctor_department" placeholder="Department">
                <label for="doctor_department">Department</label>
            </div>
            <div class="input-group">
                <i class="fas fa-id-card"></i>
                <input type="text" name="license_number" id="license_number" placeholder="License Number">
                <label for="license_number">License Number</label>
            </div>
        </div>
        <!-- Conditional fields for staff -->
        <div id="staffFields" style="display:none;">
            <div class="input-group">
                <i class="fas fa-building"></i>
                <input type="text" name="staff_department" id="staff_department" placeholder="Department">
                <label for="staff_department">Department</label>
            </div>
            <div class="input-group">
                <i class="fas fa-id-badge"></i>
                <input type="text" name="staff_id" id="staff_id" placeholder="Staff ID">
                <label for="staff_id">Staff ID</label>
            </div>
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" name="password" id="password" placeholder="Password" minlength="6" required>
            <i class="fas fa-eye toggle-password" data-target="password"></i>
            <label for="password">Password</label>
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" name="confirm_password" id="confirm_password" placeholder="Confirm Password" minlength="6" required>
            <i class="fas fa-eye toggle-password" data-target="confirm_password"></i>
            <label for="confirm_password">Confirm Password</label>
        </div>
       <input type="submit" class="btn" value="Sign Up" name="signUp">
      </form>
      
      <div class="links">
        <p>Already Have Account ?</p>
        <button id="signInButton">Sign In</button>
      </div>
    </div>

    <!-- Login Form -->
    <div class="container" id="signIn" style="display:block;">
        <h1 class="form-title">Sign In</h1>
        <form method="post" action="php/auth.php">
          <div class="input-group">
              <i class="fas fa-envelope"></i>
              <input type="email" name="email" id="loginEmail" placeholder="Email" required>
              <label for="loginEmail">Email</label>
          </div>
          <div class="input-group">
              <i class="fas fa-lock"></i>
              <input type="password" name="password" id="loginPassword" placeholder="Password" required>
              <i class="fas fa-eye toggle-password" data-target="loginPassword"></i>
              <label for="loginPassword">Password</label>
          </div>
          <div class="input-group">
              <i class="fas fa-user-tag"></i>
              <select name="role" id="loginRole" required>
                  <option value="">Login As</option>
                  <option value="patient">Patient</option>
                  <option value="doctor">Doctor</option>
                  <option value="staff">Hospital Staff</option>
                  <option value="admin">Admin</option>
              </select>
              <label for="loginRole">Role</label>
          </div>
          <p class="recover">
            <a href="#">Forgot Password?</a>
          </p>
         <input type="submit" class="btn" value="Sign In" name="signIn">
        </form>
        <p class="or"></p>

        <div class="links">
          <p>Don't have account yet?</p>
          <button id="signUpButton">Sign Up</button>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="otp-modal">
        <div class="otp-modal-content">
            <div class="otp-modal-header">
                <h2>Email Verification</h2>
                <p>We've sent a 6-digit OTP to <strong id="otpEmail"></strong></p>
            </div>
            
            <div class="otp-modal-body">
                <!-- Loading State -->
                <div id="otpLoading" class="otp-loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Sending OTP...</p>
                </div>
                
                <!-- OTP Input Section -->
                <div id="otpInputSection">
                    <div class="otp-inputs">
                        <input type="text" maxlength="1" class="otp-input" id="otp1" pattern="[0-9]" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp2" pattern="[0-9]" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp3" pattern="[0-9]" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp4" pattern="[0-9]" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp5" pattern="[0-9]" inputmode="numeric">
                        <input type="text" maxlength="1" class="otp-input" id="otp6" pattern="[0-9]" inputmode="numeric">
                    </div>
                    
                    <div class="otp-timer" id="otpTimer">
                        <i class="fas fa-clock"></i>
                        <span id="timerText">5:00</span>
                    </div>
                    
                    <div class="otp-message" id="otpMessage"></div>
                    
                    <button type="button" class="btn otp-verify-btn" id="verifyOtpBtn">
                        <i class="fas fa-check-circle"></i> Verify OTP
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="otp-modal" style="display: none;">
        <div class="otp-modal-content success-modal-content">
            <div class="success-modal-header">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2>Registration Successful!</h2>
                <p>Your account has been created successfully.</p>
            </div>
            
            <div class="success-modal-body">
                <p class="success-message">
                    Welcome to HospiLink! To access your account and start using our services, please log in with your credentials.
                </p>
                
                <button type="button" class="btn success-login-btn" id="successLoginBtn">
                    <i class="fas fa-sign-in-alt"></i> Go to Login
                </button>
            </div>
        </div>
    </div>

    <script src="sign.js"></script>
    <script src="php/otp_handler.js"></script>
    <script>
        // Show/hide role-specific fields based on role selection
        document.getElementById('role').addEventListener('change', function() {
            const doctorFields = document.getElementById('doctorFields');
            const staffFields = document.getElementById('staffFields');
            const specialization = document.getElementById('specialization');
            const doctor_department = document.getElementById('doctor_department');
            const license_number = document.getElementById('license_number');
            const staff_department = document.getElementById('staff_department');
            const staff_id = document.getElementById('staff_id');
            
            if (this.value === 'doctor') {
                doctorFields.style.display = 'block';
                staffFields.style.display = 'none';
                specialization.required = true;
                doctor_department.required = true;
                license_number.required = true;
                staff_department.required = false;
                staff_id.required = false;
            } else if (this.value === 'staff') {
                doctorFields.style.display = 'none';
                staffFields.style.display = 'block';
                specialization.required = false;
                doctor_department.required = false;
                license_number.required = false;
                staff_department.required = true;
                staff_id.required = true;
            } else {
                doctorFields.style.display = 'none';
                staffFields.style.display = 'none';
                specialization.required = false;
                doctor_department.required = false;
                license_number.required = false;
                staff_department.required = false;
                staff_id.required = false;
            }
        });

        // Note: Password validation is now handled by otp_handler.js
        // The form submission is intercepted for OTP verification

        // Password visibility toggle
        document.querySelectorAll('.toggle-password').forEach(icon => {
            icon.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    this.classList.remove('fa-eye');
                    this.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    this.classList.remove('fa-eye-slash');
                    this.classList.add('fa-eye');
                }
            });
        });
    </script>
</body>
</html>
